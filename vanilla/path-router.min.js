var m="route-page",A=class extends HTMLElement{get router(){return this.closest(p)}blockingBeforeOpen=[];blockingAfterOpen=[];blockingBeforeClose=[];blockingAfterClose=[];currentProcess;canBeOpened;canBeClosed;subrouting=!0;currentProperties;constructor(){super(),this.currentProcess=Promise.resolve(),this.canBeOpened=async()=>!0,this.canBeClosed=async()=>!0}async open(t){return await this.canBeOpened()?(this.currentProcess=this.#t(t),await this.currentProcess,this.currentProcess=Promise.resolve(),!0):(console.info("Navigation blocked by validity check."),!1)}async#t(t){if(this.dispatchEvent(new CustomEvent("beforeopen",{detail:{path:t,properties:this.currentProperties}})),await Promise.allSettled(this.blockingBeforeOpen.map(r=>r())),this.dataset.entering="",this.currentProperties=this.getProperties(t),(this.getAttribute("subrouting")??this.closest("path-router[subrouting]")?.getAttribute("subrouting"))!="false"==!0){let r=this.querySelector(":scope > path-router");if(r!=null){let s=this.extractSubroute(t);await r.subnavigate(s)}}await Promise.allSettled(this.getAnimations({subtree:!0}).map(r=>r.finished)),delete this.dataset.entering,this.toggleAttribute("open",!0),this.setAttribute("aria-current","page"),this.dispatchEvent(new Event("afteropen")),await Promise.allSettled(this.blockingAfterOpen.map(r=>r()))}async close(){return await this.canBeClosed()==!1?(console.info("Navigation blocked by validity check."),!1):(this.currentProcess=this.#e(),await this.currentProcess,this.currentProcess=Promise.resolve(),!0)}async#e(){this.dispatchEvent(new Event("beforeclose")),await Promise.allSettled(this.blockingBeforeClose.map(t=>t())),this.dataset.exiting="",this.removeAttribute("open"),await Promise.all(this.getAnimations({subtree:!0}).map(t=>t.finished)),delete this.dataset.exiting,this.removeAttribute("aria-current"),this.currentProperties=void 0,this.dispatchEvent(new Event("afterclose")),await Promise.allSettled(this.blockingAfterClose.map(t=>t()))}getProperties(t){let e=this.getAttribute("path")??"",s=(e.startsWith("/")?e.substring(1):e).split("/"),i=(t.startsWith("/")?t.substring(1):t).split("/"),u={};for(let a=0;a<s.length;a++){let o=s[a];if(o.startsWith(":")){let l=o.substring(1);l.endsWith("?")&&(l=l.substring(0,l.length-1)),u[l]=a<i.length?i[a]:""}}return u}extractSubroute(t){let e=this.getAttribute("path")??"",s=(e.startsWith("/")?e.substring(1):e).split("/"),i=(t.startsWith("/")?t.substring(1):t).split("/"),u=s.findLastIndex(o=>!o.startsWith(":"))+1;return i.slice(u).join("/")}applyEventListener(t,e,r){let s=this.getAttribute("open")!=null;this.addEventListener(t,e,r),(t=="beforeopen".toString()||t=="afteropen".toString())&&s==!0?this.dispatchEvent(new Event(t)):(t=="beforeclose".toString()||t=="afterclose".toString()&&s==!1)&&this.dispatchEvent(new Event(t))}addBlockingEventListener(t,e){switch(t){case"beforeopen":this.blockingBeforeOpen.push(e);break;case"afteropen":this.blockingAfterOpen.push(e);break;case"beforeclose":this.blockingBeforeClose.push(e);break;case"afterclose":this.blockingAfterClose.push(e);break}}applyBlockingEventListener(t,e){let r=this.getAttribute("open")!=null;this.addBlockingEventListener(t,e),(t=="beforeopen".toString()||t=="afteropen".toString())&&r==!0?this.dispatchEvent(new Event(t)):(t=="beforeclose".toString()||t=="afterclose".toString()&&r==!1)&&this.dispatchEvent(new Event(t))}};customElements.get(m)==null&&customElements.define(m,A);var v="route-dialog",E=class extends HTMLDialogElement{get router(){return this.closest(p)}blockingBeforeOpen=[];blockingAfterOpen=[];blockingBeforeClose=[];blockingAfterClose=[];currentProcess;canBeOpened;canBeClosed;currentProperties;constructor(){super(),this.currentProcess=Promise.resolve(),this.canBeOpened=async()=>!0,this.canBeClosed=async()=>!0}async openRoute(t){return await this.canBeOpened()?(this.currentProcess=this.#t(t),await this.currentProcess,this.currentProcess=Promise.resolve(),!0):(console.info("Navigation blocked by validity check."),!1)}async#t(t){if(this.dispatchEvent(new CustomEvent("beforeopen",{detail:{path:t,properties:this.currentProperties}})),await Promise.allSettled(this.blockingBeforeOpen.map(r=>r())),this.setAttribute("data-entering",""),this.currentProperties=this.getProperties(t),(this.getAttribute("subrouting")??this.closest("path-router[subrouting]")?.getAttribute("subrouting"))!="false"==!0){let r=this.querySelector(":scope > path-router");if(r!=null){let s=this.extractSubroute(t);await r.subnavigate(s)}}this.dataset.modal!=null?this.showModal():this.show(),this.setAttribute("aria-current","page"),await Promise.allSettled(this.getAnimations({subtree:!0}).map(r=>r.finished)),this.removeAttribute("data-entering"),this.dispatchEvent(new Event("afteropen")),await Promise.allSettled(this.blockingAfterOpen.map(r=>r()))}async closeRoute(){return await this.canBeClosed()==!1?(console.info("Navigation blocked by validity check."),!1):(this.currentProcess=this.#e(),await this.currentProcess,this.currentProcess=Promise.resolve(),!0)}async#e(){this.dispatchEvent(new Event("beforeclose")),await Promise.allSettled(this.blockingBeforeClose.map(t=>t())),this.setAttribute("data-exiting",""),this.close(),this.removeAttribute("aria-current"),await Promise.all(this.getAnimations({subtree:!0}).map(t=>t.finished)),this.dispatchEvent(new Event("afterclose")),await Promise.allSettled(this.blockingAfterClose.map(t=>t()))}getProperties(t){let e=this.getAttribute("path")??"",s=(e.startsWith("/")?e.substring(1):e).split("/"),i=(t.startsWith("/")?t.substring(1):t).split("/"),u={};for(let a=0;a<s.length;a++){let o=s[a];if(o.startsWith(":")){let l=o.substring(1);l.endsWith("?")&&(l=l.substring(0,l.length-1)),u[l]=a<i.length?i[a]:""}}return u}extractSubroute(t){let e=this.getAttribute("path")??"",s=(e.startsWith("/")?e.substring(1):e).split("/"),i=(t.startsWith("/")?t.substring(1):t).split("/"),u=s.findLastIndex(o=>!o.startsWith(":"))+1;return i.slice(u).join("/")}applyEventListener(t,e,r){let s=this.getAttribute("open")!=null;this.addEventListener(t,e,r),(t=="beforeopen".toString()||t=="afteropen".toString())&&s==!0?this.dispatchEvent(new Event(t)):(t=="beforeclose".toString()||t=="afterclose".toString()&&s==!1)&&this.dispatchEvent(new Event(t))}addBlockingEventListener(t,e){switch(t){case"beforeopen":this.blockingBeforeOpen.push(e);break;case"afteropen":this.blockingAfterOpen.push(e);break;case"beforeclose":this.blockingBeforeClose.push(e);break;case"afterclose":this.blockingAfterClose.push(e);break}}};customElements.get(v)==null&&customElements.define(v,E,{extends:"dialog"});var M="route-link",C=class extends HTMLAnchorElement{constructor(){super()}connectedCallback(){let t=this.#t();t!=null?(t.addEventListener("pathchange",this.#r.bind(this)),this.addEventListener("click",this.onClick.bind(this,t))):console.warn("No path router found. Clicking this button will have no navigation effect")}onClick(t){let e=this.getAttribute("path")??this.getAttribute("data-path")??"";e=this.#e(),t.navigate(e)}#t(){let t=this.getAttribute("for"),e=this.getAttribute("target"),r=t!=null?`#${t}`:e??"path-router";return this.getRootNode().querySelector(r)}#e(){let t=this.getAttribute("path")??this.getAttribute("data-path")??"";return t=this.onPreparePath(t),t}onPreparePath(t){return t}#r(t){let e=this.getAttribute("path");if(e==null){console.log("link");return}let r=this.#t();if(r==null){console.log("target");return}r.pathIsActive(e)?this.setAttribute("aria-current","page"):this.removeAttribute("aria-current")}};customElements.get(M)==null&&customElements.define(M,C,{extends:"a"});var T="route-button",w=class extends HTMLButtonElement{constructor(){super()}connectedCallback(){let t=this.#t();t!=null?(t.addEventListener("pathchange",this.#e.bind(this)),this.addEventListener("click",this.onClick.bind(this,t))):console.warn("No path router found. Clicking this button will have no navigation effect")}onClick(t){let e=this.getAttribute("path")??this.getAttribute("data-path")??"";e=this.#r(),t.navigate(e)}#t(){let t=this.getAttribute("for"),e=this.getAttribute("target"),r=t!=null?`#${t}`:e??"path-router";return this.getRootNode().querySelector(r)}#e(){let t=this.getAttribute("path");if(t==null)return;let e=this.#t();if(e==null)return;e.pathIsActive(t)?this.setAttribute("aria-current","page"):this.removeAttribute("aria-current")}#r(){let t=this.getAttribute("path")??this.getAttribute("data-path")??"";return t=this.onPreparePath(t),t}onPreparePath(t){return t}};customElements.get(T)==null&&customElements.define(T,w,{extends:"button"});var y=(r=>(r.Change="change",r.PathChange="pathchange",r.PathCompose="pathcompose",r))(y||{}),O=new CSSStyleSheet;O.replaceSync(`
/* 
   Animations will not be awaitable in code if they have a display of none.
   Instead, the routes are stacked in a grid.
 */
path-router
{ 
    display: var(--router-display, grid);
    grid-template-columns: 1fr;
    grid-template-rows: 1fr;
}
route-page:not([open],[data-entering],[data-exiting]) path-router { display: none; /* browser bug when rendering visibility? */ }
route-page
{
    display: var(--route-display, block);
    visibility: hidden;
    grid-row: 1;
    grid-column: 1;
}
/* 
   Visibility is visible during the entering and exiting phases
   to allow for animations to be awaited.
 */
route-page[open]
,route-page[data-entering]
,route-page[data-exiting]
{
    visibility: visible;
}
[is="route-link"]
,[is="route-button"]
{
    user-select: none;
}`);var p="path-router",k=class extends HTMLElement{get routes(){return Array.from(this.querySelectorAll(`:scope > ${m}`),t=>t)}get routeDialogs(){return Array.from(this.querySelectorAll(`:scope > [is="${v}"]`),t=>t)}targetPageRoute;currentPageRoute;targetDialogRoute;currentDialogRoute;defaultRoute;get path(){return this.getAttribute("path")}set path(t){this.setAttribute("path",t)}subpaths=[];subrouting=!0;isInitialized=!1;#t;#e=[];#r=new Map;#i=new Map;#n=new Map;resolveNavigation;constructor(){super(),this.addEventListener("pathchange",t=>{t.target!=this&&this.#u()}),this.#t=this.#h(),this.#c()}async#h(){return new Promise(t=>{document.addEventListener("DOMContentLoaded",async()=>{for(let s=0;s<this.routes.length;s++){let n=this.routes[s];this.defaultRoute==null&&(this.defaultRoute=n);let i=n.getAttribute("path");n.hasAttribute("default")==!0&&(this.defaultRoute=n)}let e=[...this.querySelectorAll("dialog")];for(let s=0;s<e.length;s++)e[s].addEventListener("close",async n=>{if(!(e[s].getAttribute("data-exiting")!=null)){let a=(this.getAttribute("path")??"/").split("#")[0];await this.navigate(a)}e[s].removeAttribute("data-exiting")});let r=[...this.querySelectorAll("path-router")];for(let s=0;s<r.length;s++)r[s].toggleAttribute("subrouter",!0);this.#r=new Map(this.routes.map(s=>[s.getAttribute("path")??"",s])),this.#i=new Map(this.routeDialogs.map(s=>[s.getAttribute("path")??"",s])),this.#n=new Map([...this.#r,...this.#i]),this.isInitialized=!0,t()})})}async#c(){if(await this.#t,!this.hasAttribute("manual"))for(let t=0;t<this.#e.length;t++)await this.#a(this.#e[t].newValue,this.#e[t].oldValue)}async navigate(t){return new Promise(e=>{this.resolveNavigation=e,this.setAttribute("path",t)})}async subnavigate(t){return this.toggleAttribute("subnavigating",!0),this.navigate(t)}async#a(t,e){await this.#t;let[r,s]=this.destructurePath(t),[n,i]=this.destructurePath(e),u=!1,a=!1,o=s!=""&&r==""?!1:n!=r,l=s!=i;if(o==!1&&l==!1&&this.querySelector("[open]")!=null)return this.resolveNavigation!=null&&(this.resolveNavigation(),this.resolveNavigation=void 0),[u,a];await this.#g();let[h,c]=this.#p(t),R;if(o==!0||this.querySelector("[open]")==null){if(await this.#b()==!1)return console.warn("Navigation was prevented."),console.info(`Requested path: ${t}`),this.resolveNavigation!=null&&(this.resolveNavigation(),this.resolveNavigation=void 0),!1;R=this.#f(h,r)}return(o||i!=s)&&await this.#m()!=!1&&(this.targetDialogRoute=c,a=await this.#P(c,s)),await R,this.targetPageRoute=void 0,this.targetDialogRoute=void 0,this.resolveNavigation!=null&&(this.resolveNavigation(),this.resolveNavigation=void 0),this.#u(),this.removeAttribute("subnavigating"),this.dispatchEvent(new CustomEvent("pathchange",{detail:{path:t,supaths:this.subpaths},bubbles:!0,cancelable:!0})),[u,a]}async#u(){let t=this.getAttribute("composedPath"),e=this.composeRoutePath();this.setAttribute("composed-path",e),this.getAttribute("subrouter")==null&&this.dispatchEvent(new CustomEvent("pathcompose",{detail:{composedPath:e,previousComposedPath:t},bubbles:!0,cancelable:!0}))}async#g(){return Promise.allSettled(this.routes.map(t=>t.currentProcess))}#p(t){let[e,r]=this.destructurePath(t),s=this.#s(e),n=this.#o(s,this.#r),i;if(r!=""){let u=this.#s(r);i=this.#o(u,this.#i)}return[n,i]}#s(t){return t=this.trimCharacter(t,"/"),t.split("/")}#o(t,e){let r;for(let[s,n]of e){s=this.trimCharacter(s,"/");let i=s.split("/"),{match:u,resolved:a}=this.#d(t,i);if(a!=!1){for(let o=t.length;o<i.length;o++)if(i[o].startsWith(":")==!1){u=!1;break}u==!0&&(r=n)}}return r}#d(t,e){let r=!1,s=!1;for(let n=0;n<t.length;n++){let i=e[n];if(i==null){if(s==!0)continue;return{match:!1,resolved:!1}}let u=i.startsWith(":");if(u==!1&&i!=t[n])return{match:!1,resolved:!1};r=!0,s=u}return{match:r,resolved:!0}}async#f(t,e){if(this.targetPageRoute=t,this.targetPageRoute=this.targetPageRoute||this.defaultRoute,this.targetPageRoute==null)return!1;let r=await this.targetPageRoute.open(e);return r&&(this.currentPageRoute=this.targetPageRoute,this.dispatchEvent(new CustomEvent("change",{detail:{route:this.targetPageRoute,path:e}}))),r}async#P(t,e){if(this.targetDialogRoute=t,this.targetDialogRoute==null)return!1;let r=await this.targetDialogRoute.openRoute(e);return r&&(this.currentDialogRoute=this.targetDialogRoute,this.dispatchEvent(new CustomEvent("change",{detail:{route:this.targetDialogRoute,path:e}}))),r}async#b(){if(this.currentPageRoute==null)return!0;let t=await this.currentPageRoute.close();return t==!0&&(this.currentPageRoute=void 0),t}async#m(){if(this.currentDialogRoute==null)return!0;let t=await this.currentDialogRoute.closeRoute();return t==!0&&(this.currentDialogRoute=void 0),t}#l(t){let e=t.split("#"),r=e[0],s=t.length>1?e[1]:null,n=s==null?[""]:s.split("?"),i=n==null?"":n[0];return{pathname:r,hash:i}}destructurePath(t){let{pathname:e,hash:r}=this.#l(t);if(e.trim()==""&&r!=""){let s=this.getAttribute("path")??"",{pathname:n}=this.#l(s);e=n}return[e,r]}trimCharacter(t,e){let r=new RegExp(`^\\${e}|${e}$`,"gm");return t.replace(r,"")}composeRoutePath(){let t=this.getAttribute("path")??"",[e,r]=this.destructurePath(t),s=new f;s.path=e,s.hash=r;let n=this.targetPageRoute??this.currentPageRoute;n!=null&&(s=this.#v(n,s));let i=this.targetDialogRoute??this.currentDialogRoute;return i!=null&&(s.isDialogRoute=!1,s=this.#R(i,s)),this.#A(s.path,s.hash,s.subroutePath,s.subrouteHash,s.properties)}#v(t,e=new f){if(t!=null){Object.assign(e.properties,t.currentProperties);let r=t.getAttribute("path")??"",[s,n]=this.destructurePath(r);e.path=s??e.path,e.hash=n.trim()==""?e.hash:n;let i=t.querySelector("path-router");if(i!=null){let u=i.composeRoutePath(),a="";[e.subroutePath,a]=this.destructurePath(u),e.isDialogRoute==!0&&(e.subrouteHash=a);let o=i.targetPageRoute??i.currentPageRoute;o!=null&&Object.assign(e.properties,o.currentProperties)}}return e}#R(t,e=new f){if(t!=null){Object.assign(e.properties,t.currentProperties);let r=t.querySelector("path-router");if(r!=null){let s=r.composeRoutePath(),[n]=this.destructurePath(s),i=r.targetPageRoute??r.currentPageRoute;i!=null&&Object.assign(e.properties,i.currentProperties),n=t.getAttribute("path").replace(/:[\s\S]*/gm,n),n=this.trimCharacter(n,"/");let a=n.split("/"),o=e.hash.split("/");for(let l=0;l<a.length;l++)a[l]!=o[l]&&(o[l]!=null?o[l]=a[l]:o.push(a[l]));e.hash=o.join("/")}}return e}#A(t,e,r,s,n){let i=t.split("/"),u=r.split("/"),a=i[i.length-1].startsWith(":"),o=e.split("/"),l=s.split("/"),h=o[o.length-1].startsWith(":");for(let[g,b]of Object.entries(n)){let S=i.indexOf(`:${g}`);S>-1&&(i[S]=b);let N=u.indexOf(`:${g}`);N>-1&&(u[N]=b);let x=o.indexOf(`:${g}`);x>-1&&(o[x]=b);let D=l.indexOf(`:${g}`);D>-1&&(l[D]=b)}a==!0&&(i[i.length-1]=u[0],u.shift()),h==!0&&(o[o.length-1]=l[0],l.shift()),t=i.concat(u).join("/");let P=o.concat(l).filter(g=>g.trim()!="").join("/");return P.trim()!=""&&(t=t.endsWith("/")?t.substring(0,t.length-1):t,t+=`#${P}`),t=t.replace("//","/"),t}compareLocations(t,e){let r=!1,s=!1;return e.pathname!=t.pathname?r=!0:e.pathname==t.pathname&&e.hash!=t.hash&&(r=!0,t.hash!=""&&e.hash!=""&&(s=!0)),{hasChanged:r,isReplacementChange:s}}pathIsActive(t){let[e,r]=this.destructurePath(t),s=this.getAttribute("path")??"/",[n,i]=this.destructurePath(s),u=this.#s(e),a=e==""&&n==""?this.defaultRoute:this.#o(u,this.#n);if(a==null)return!1;let o=this.currentPageRoute==a;if(o==!0){let h=a.extractSubroute(e);if(a.getAttribute("subrouting")!="false"&&h!=""){let c=a.querySelector(":scope > path-router");c!=null&&(o=c.pathIsActive(h))}}let l=!1;return r==i&&(l=!0),!!(o==!0&&t.indexOf("#")==-1||o==!0&&l==!0||t.startsWith("#")&&l==!0)}getRouteProperties(t={}){if(this.currentPageRoute==null)return{};let e=this.getAttribute("path")??"/",r=this.#s(e),s=this.#s(this.currentPageRoute.getAttribute("path")??"/"),n;for(let u=0;u<s.length;u++){let a=s[u];if(a.startsWith(":")){if(n==null){let o=r[0];o.indexOf("#")>-1&&(o=o.split("#")[0]),t[this.trimCharacter(a,":")]=o;continue}for(let o=0;o<r.length-1;o++)if(r[o]==n){let h=r[o+1];h.indexOf("#")>-1&&(h=h.split("#")[0]),t[this.trimCharacter(a,":")]=h}}n=a}let i=this.currentPageRoute.querySelector("path-router");return i!=null&&(t=i.getRouteProperties(t)),t}static getUrlParameters(t){let r=new URL(t).pathname,n=(r.startsWith("/")?r.substring(1):r).split("/"),i={},u=null;for(let a=0;a<n.length;a++){let o=n[a];u==null?u=o:(i[u]=o,u=null)}return i}connectedCallback(){let t=this.getRootNode();t.adoptedStyleSheets.indexOf(O)==-1&&t.adoptedStyleSheets.push(O)}static observedAttributes=["path","subrouting"];attributeChangedCallback(t,e,r){if(t=="path")this.isInitialized==!0?this.#a(r,e??""):this.#e.push({newValue:r,oldValue:e??""});else if(t=="subrouting")if(r=="false"){this.subrouting=!1;for(let s=0;s<this.routes.length;s++)this.routes[s].setAttribute(t,"false")}else{this.subrouting=!0;for(let s=0;s<this.routes.length;s++)this.routes[s].removeAttribute("subrouting")}}};customElements.get(p)==null&&customElements.define(p,k);var f=class{path="";hash="";subroutePath="";subrouteHash="";properties={};isDialogRoute=!0};export{p as COMPONENT_TAG_NAME,k as PathRouterElement,y as PathRouterEvent};
