var N=`/* \r
   Animations will not be awaitable in code if they have a display of none.\r
   Instead, the routes are stacked in a grid.\r
 */\r
path-router\r
,.route-view\r
{ \r
    display: var(--router-display, grid);\r
    grid-template-columns: 1fr;\r
    grid-template-rows: 1fr;\r
}\r
\r
route-page\r
{\r
    display: var(--route-display, block);\r
    visibility: hidden;\r
    grid-row: 1;\r
    grid-column: 1;\r
}\r
/* \r
   Visibility is visible during the entering and exiting phases\r
   to allow for animations to be awaited.\r
 */\r
route-page[open]\r
,route-page[data-entering]\r
,route-page[data-exiting]\r
{\r
    visibility: visible;\r
}\r
\r
/* sub routes should respect the visibility of the parent routes */\r
route-page:not([open],[data-entering],[data-exiting]) route-page[open]\r
{\r
    visibility: inherit;\r
}`;var T=(v=HTMLElement)=>class extends v{currentProcess=Promise.resolve();canBeOpened=async()=>!0;canBeClosed=async()=>!0;getProperties(){return Object.entries(this.dataset).reduce((s,i)=>{let o=i[0];if(!o.startsWith(A))return s;let n=o[A.length].toLowerCase()+o.substring(A.length+1),r=i[1];return s[n]=r,s},{})}async enter(t){return await this.canBeOpened()?(this.currentProcess=this.#s(t),await this.currentProcess,this.currentProcess=Promise.resolve(),!0):(console.info("Navigation blocked by validity check."),!1)}async#s(t){this.dispatchEvent(new CustomEvent("beforeopen",{detail:{path:t,properties:this.getProperties()}})),await Promise.allSettled(this.#i.map(e=>e())),this.dataset.entering="",await Promise.allSettled(this.getAnimations({subtree:!0}).map(e=>e.finished)),delete this.dataset.entering,this.#e(),this.dispatchEvent(new Event("afteropen")),await Promise.allSettled(this.#r.map(e=>e()))}async#e(){this.toggleAttribute("open",!0),this.setAttribute("aria-current","page")}async exit(){return await this.canBeClosed()==!1?(console.info("Navigation blocked by validity check."),!1):(this.currentProcess=this.#t(),await this.currentProcess,this.currentProcess=Promise.resolve(),!0)}async#t(){this.dispatchEvent(new Event("beforeclose")),await Promise.allSettled(this.#n.map(t=>t())),this.dataset.exiting="",this.removeAttribute("open"),await Promise.all(this.getAnimations({subtree:!0}).map(t=>t.finished)),this.#o(),delete this.dataset.exiting,this.dispatchEvent(new Event("afterclose")),await Promise.allSettled(this.#a.map(t=>t()))}#o(){this.toggleAttribute("open",!1),this.removeAttribute("aria-current")}#i=[];#r=[];#n=[];#a=[];applyEventListener(t,e,s){let i=this.getAttribute("open")!=null;this.addEventListener(t,e,s),(t=="beforeopen".toString()||t=="afteropen".toString())&&i==!0?this.dispatchEvent(new Event(t)):(t=="beforeclose".toString()||t=="afterclose".toString()&&i==!1)&&this.dispatchEvent(new Event(t))}addBlockingEventListener(t,e){switch(t){case"beforeopen":this.#i.push(e);break;case"afteropen":this.#r.push(e);break;case"beforeclose":this.#n.push(e);break;case"afterclose":this.#a.push(e);break}}applyBlockingEventListener(t,e){let s=this.getAttribute("open")!=null;this.addBlockingEventListener(t,e),(t=="beforeopen".toString()||t=="afteropen".toString())&&s==!0?this.dispatchEvent(new Event(t)):(t=="beforeclose".toString()||t=="afterclose".toString()&&s==!1)&&this.dispatchEvent(new Event(t))}};var m="route-dialog",b=class extends T(HTMLDialogElement){};customElements.get(m)==null&&customElements.define(m,b,{extends:"dialog"});var d="route-page",O=class extends T(){};customElements.get(d)==null&&customElements.define(d,O);var _=(e=>(e.Change="change",e.PathChange="pathchange",e))(_||{}),M=new CSSStyleSheet;M.replaceSync(N);var B=new Promise(v=>document.addEventListener("DOMContentLoaded",v)),A="property",y="path-router",x=class extends HTMLElement{get routePages(){return Array.from(this.querySelectorAll(`:scope > ${d}, ${y} :not(${y}) ${d}`),t=>t)}get routeDialogs(){return Array.from(this.querySelectorAll(`:scope > [is="${m}"]`),t=>t)}get routes(){return Array.from(this.querySelectorAll(`:scope > ${d},${y} :not(${y}) ${d},:scope > [is="${m}"]`),t=>t)}targetPageRoute;currentPageRoute;targetDialogRoute;currentDialogRoute;defaultRoute;get path(){return this.getAttribute("path")}set path(t){this.setAttribute("path",t)}#s;#e=[];#t;async navigate(t){return new Promise(e=>{this.#t=e,this.setAttribute("path",t)})}addRouteLinkClickHandlers(t,e="a[data-route],button[data-route]"){t=t??document.body,t.addEventListener("click",s=>{let i=s.target.closest("a[data-route],button[data-route]");if(i!=null&&t.contains(i)){let o=[...t.querySelectorAll(e)];for(let r=0;r<o.length;r++)o[r].removeAttribute("aria-current");let n=i.dataset.route;if(n.indexOf(":")!=-1){let r=i.closest('route-page,[is="route-dialog"]');for(;r!=null;){let l=r.getProperties(),c=n.split("/").filter(a=>a.startsWith(":"));for(let a=0;a<c.length;a++){let f=c[a].substring(1);l[f]!=null&&(n=n.replace(`:${f}`,l[f]))}r=r.parentElement?.closest('route-page,[is="route-dialog"]')}}if(n.startsWith("#")){let l=(this.path??"").split("#");l[1]=n.substring(1),n=l.join("#")}this.setAttribute("path",n),i.setAttribute("aria-current","page")}})}compareLocations(t,e){let s=!1,i=!1;return e.pathname!=t.pathname?s=!0:e.pathname==t.pathname&&e.hash!=t.hash&&(s=!0,t.hash!=""&&e.hash!=""&&(i=!0)),{hasChanged:s,isReplacementChange:i}}async#o(t,e){if(this.#l==!1)throw new Error("Unable to update path-router before activation.");let s=t.startsWith("/")?t.substring(1):t,[i,o]=this.#i(s),[n,r]=this.#i(e),l=!1,c=!1,a=o!=""&&i==""?!1:n!=i,f=o!=r,P=this.querySelector("[open]");if(a==!1&&f==!1&&P!=null)return this.#t!=null&&(this.#t(),this.#t=void 0),P.dispatchEvent(new CustomEvent("refresh",{detail:{path:t},bubbles:!0,cancelable:!0})),[l,c];await this.#a();let R=this.#r(s),g=R.filter(p=>p.route instanceof O),E=R.filter(p=>p.route instanceof b),w=new Promise(p=>p(!1));g=this.#n(g);let S=!1,k=g.map(p=>p.route);if(a==!0||P==null){if(await this.#p(k)==!1)return console.warn("Navigation was prevented."),console.info(`Requested path: ${t}`),this.#t!=null&&(this.#t(),this.#t=void 0),!1;S=!0;for(let u=0;u<g.length;u++){let h=g[u];w=this.#u(h.route,o),this.#h(h.route,h.properties)}}if((a||r!=o)&&await this.#d(E.map(u=>u.route))!=!1){for(let u=0;u<E.length;u++){let h=E[u];if(c=await this.#g(h.route,o),this.#h(h.route,h.properties),S==!1){let D=[...h.route.querySelectorAll("route-page")];for(let C=0;C<D.length;C++)k.indexOf(D[C])>-1||await D[C].exit()}}for(let u=0;u<g.length;u++){let h=g[u];h.route.closest(`[is="${m}"][open]`)!=null&&(w=this.#u(h.route,o),this.#h(h.route,h.properties))}}return l=await w,this.targetPageRoute=void 0,this.targetDialogRoute=void 0,this.#t!=null&&(this.#t(),this.#t=void 0),this.dispatchEvent(new CustomEvent("pathchange",{detail:{sanitizedPath:s},bubbles:!0,cancelable:!0})),[l,c]}#i(t){let e=t.split("#"),s=e[0],i=t.length>1?e[1]:null,o=i==null?[""]:i.split("?"),n=o==null?"":o[0];return[s,n]}#r(t){let e=[],s=[];for(let i=0;i<this.routes.length;i++){let o=this.routes[i],[n,r]=this.routeMatchesPath(o,t,s,o instanceof b);n==!0&&(e.push({route:o,properties:r}),s.push(o))}return e}#n(t){let e=[];for(let i=0;i<t.length;i++){let o=t[i],n=o.route.getAttribute("path"),r=o.route.parentElement?.closest('route-page,[is="route-dialog"],path-router'),l=t.find(a=>e.indexOf(a)==-1&&a!=o&&a.route.parentElement?.closest('route-page,[is="route-dialog"],path-router')==r);if(l==null)continue;if(n?.startsWith(":")){e.push(o);continue}l.route.getAttribute("path")?.startsWith(":")&&e.push(l)}return t.filter(i=>e.indexOf(i)==-1)}async#a(){return Promise.allSettled(this.routes.map(t=>t.currentProcess))}async#u(t,e){if(this.targetPageRoute=t,this.targetPageRoute=this.targetPageRoute||this.defaultRoute,this.targetPageRoute==null)return!1;let s=await this.targetPageRoute.enter(e);return s&&(this.currentPageRoute=this.targetPageRoute,this.dispatchEvent(new CustomEvent("change",{detail:{route:this.targetPageRoute,path:e}}))),s}async#g(t,e){if(this.targetDialogRoute=t,this.targetDialogRoute==null)return!1;let s=await this.targetDialogRoute.enter(e);return s&&(this.currentDialogRoute=this.targetDialogRoute,this.dispatchEvent(new CustomEvent("change",{detail:{route:this.targetDialogRoute,path:e}}))),s}async#p(t){let e=this.routePages.filter(i=>i.getAttribute("aria-current")=="page"),s=!0;for(let i=0;i<e.length;i++)t.indexOf(e[i])>-1||(s=s==!1?s:await e[i].exit());return s}async#d(t){let e=this.routeDialogs.filter(i=>i.getAttribute("aria-current")=="page"),s=!0;for(let i=0;i<e.length;i++)t.indexOf(e[i])>-1||(s=s==!1?s:await e[i].exit());return s}#h(t,e){for(let[s,i]of Object.entries(e)){let o=A+s.substring(0,1).toUpperCase()+s.substring(1);t.dataset[o]=i}}routeMatchesPath(t,e,s,i=!1){let o=e.split("#"),n=o[0],r=o.length>1?o[1]:null,c=(t.getAttribute("path")??"").split("/"),a=n.split("/");if((t.closest(`[is="${m}"]`)==null?"Page":"Dialog")=="Page")return this.routeTypeMatches(t,a,c,`${d}`,s);if(r==null)return[!1,{}];let P=r.split("/");return this.routeTypeMatches(t,P,c,`${d},[is="${m}"]`,s)}routeTypeMatches(t,e,s,i,o){if(e.length==1&&e[0].trim()=="")return[s.length==1&&s[0].trim()=="",{}];let n=[],r=t.parentElement?.closest(i);for(;r!=null;){if(o.indexOf(r)==-1)return[!1,{}];n.push(r),r=r.parentElement?.closest(i)}let c=n.reverse().reduce((R,g,E)=>`${R==""?"":R+"/"}${g.getAttribute("path")??""}`,"").split("/"),a=[...e].filter((R,g)=>{let E=c[g];return!(E?.startsWith(":")==!0||E==R)}),{match:f,properties:P}=this.pathArraySelectsRouteArray(a,s);return[f,P]}getRouteProperties(t){if(t!=null)return t.getProperties();let e={};for(let s=0;s<this.routes.length;s++){let i=this.routes[s];Object.assign(e,i.getProperties())}return e}pathArraySelectsRouteArray(t,e){let s={};if(e.length>t.length)return{match:!1,properties:s};let i=!1;for(let o=0;o<t.length;o++){let n=e[o],r=t[o];if(n==null)return{match:i,properties:s};if(n.startsWith(":")==!1){if(n!=r)return{match:!1,properties:s}}else s[n.substring(1)]=r;i=!0}return{match:i,properties:s}}async connectedCallback(){this.#s=this.#f(),this.#A(),await this.#s,await this.#P(),this.getAttribute("path")!=null&&this.currentPageRoute==null&&this.defaultRoute!=null&&this.#u(this.defaultRoute,"")}disconnectedCallback(){this.#v()}#l=!1;async#f(){await B,this.#m(),this.#R(),this.#l=!0}#m(){this.defaultRoute=this.querySelector("route-page[default]"),this.defaultRoute==null&&(this.defaultRoute=this.querySelector("route-page"))}async#P(){for(let t=0;t<this.#e.length;t++)await this.#o(this.#e[t].newValue,this.#e[t].oldValue)}#c=this.#E.bind(this);#R(){for(let t=0;t<this.routeDialogs.length;t++)this.routeDialogs[t].addEventListener("close",this.#c)}async#E(t){let e=t.target;if(!(e.getAttribute("data-exiting")!=null)){let o=(this.getAttribute("path")??"/").split("#")[0];await this.navigate(o)}e.removeAttribute("data-exiting")}#v(){this.#b(),this.#y(),this.#s=void 0,this.#l=!1}#b(){this.defaultRoute!=null&&(this.defaultRoute=void 0)}#y(){this.removeEventListener("close",this.#c)}#A(){let t=this.getRootNode();t.adoptedStyleSheets.indexOf(M)==-1&&t.adoptedStyleSheets.push(M)}static observedAttributes=["path"];attributeChangedCallback(t,e,s){t=="path"&&(this.#l==!0?this.#o(s,e??""):this.#e.push({newValue:s,oldValue:e??""}))}};customElements.get(y)==null&&customElements.define(y,x);export{y as COMPONENT_TAG_NAME,x as PathRouterElement,_ as PathRouterEvent,A as ROUTEPROPERTY_DATA_ATTRIBUTE_KEYWORD};
