<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Path Router Demo</title>
    <link rel="stylesheet" href="./demo-page.css">
    <link rel="stylesheet" href="../vanilla/tabs.theme.css">
    <link rel="stylesheet" href="../vanilla/sidebar.theme.css">
    <link rel="stylesheet" href="../vanilla/heading-nav.theme.css">
  </head>
  <body>
    <main>
      <h1>Overview</h1>
      <div class="overview">
        <div class="description">
          <h2>Description</h2>
          <p>The
            <code>&lt;path-router&gt;</code>
            element allows developers to show and hide sections of html contained in "routes" which can either be defined using
            <code>&lt;route-page&gt;</code>
            or
            <code>route-dialog</code>
            child elements.</p>
          <p>Routing is done by matching the the
            <code>&lt;path-router&gt;</code>
            element's
            <code>path</code>
            attribute to one of its child route's
            <code>path</code>
            attribute.</p>
          <p>Matching path values can be as simple as exact string matches. Many types of routing can be done without any type of dynamic content or subrouting.</p>
          <p>The
            <code>&lt;path-router&gt;</code>
            element does, however, account for dynamic content and subrouting by allowing complex matching that uses common string patterns for variables, and partial-path matching so that subrouting can be done with the unmatched path content.</p>
          <p>If the
            <code>&lt;path-router&gt;</code>
            element's
            <code>path</code>
            attribute finds a child route that matches, that route will be displayed.</p>
          <p>If no route can be found that matches the
            <code>&lt;path-router&gt;</code>
            element's
            <code>path</code>
            attribute, no route will be displayed.</p>
        </div>
        <div class="features">
          <h2>Features</h2>
          <div>
            <header>Transitions</header>
            <dl>
              <dt>Blocking</dt>
              <dd>The
                <code>&lt;path-router&gt;</code>
                element dispatches events and allows for asynchronous blocking during route opening and closing procedures.</dd>
              <dt>CSS Integration</dt>
              <dd>CSS transitions and animations, including opacity fades and animation effects like bouncing or rotating, are awaited by the
                <code>&lt;path-router&gt;</code>
                element, allowing for event handling before and after animations without needing to set up timers or callbacks.</dd>
            </dl>
          </div>
          <div>
            <header>Dialog Routes</header>
            <p>To account for the common design pattern of dialog routes, while still maintaining best practices for route history manamgent, the
              <code>&lt;path-router&gt;</code>
              element uses the hash character (<code>#</code>) to match with any
              <code>route-dialog</code>
              child elements.</p>
          </div>
          <div>
            <header>Links and Buttons</header>
            <p>As an additional convenience, this library also provides two optional elements: the
              <code>route-link</code>
              and
              <code>route-button</code>
              elements. These elements allow developers to set a
              <code>path</code>
              attribute that will then be applied to the
              <code>&lt;path-router&gt;</code>'s
              <code>path</code>
              attribute whenever either are clicked.</p>
          </div>
        </div>
      </div>
      <h1>Examples</h1>
      <!-- <article>
            <header>Quick Reference</header>
            <div class="description">
                <p>This is the code used in the Quick Reference section of the README.</p>
                <p>It is implemented, here, as a sanity check.</p>
            </div>
            <div class="example">
                <menu>
                    <a is="route-link" for="my-router" data-theme="heading-nav" path="/">Home</a>
                    <a is="route-link" target="#my-router" data-theme="heading-nav" path="about">About</a>
                    <a is="route-link" target=".router" data-theme="heading-nav" path="contact">Contact</a>
                </menu>
                <path-router path="home" id="my-router" class="router" data-theme="heading-nav">
                    <route-page path="home">
                        <header>Home</header>
                        <div>
                            <p>Welcome to the website!</p>
                            <button is="route-button" data-theme="heading-nav" path="#config">
                                Open Config
                            </button>
                            <button is="route-button" data-theme="heading-nav" path="#config/app">
                                Open App Config
                            </button>
                        </div>
                    </route-page>
                    <route-page path="about">    
                        <header>About</header>
                        <div>
                            <p>About this website:</p>
                        </div>
                    </route-page>
                    <route-page path="contact">    
                        <header>Contact</header>
                        <div>
                            <p>Contact Us:</p>
                            <a>contact@mydomain.com</a>
                        </div>
                    </route-page>
                    <dialog is="route-dialog" path="config/:subroute">    
                        <header>Configuration</header>
                        <menu data-theme="tabs">
                            <a is="route-link" data-theme="tabs" for="config-router" path="/">User</a>
                            <a is="route-link" data-theme="tabs" for="config-router" path="app">App</a>
                        </menu>
                        <path-router id="config-router" data-theme="tabs">
                            <route-page path="/">
                                <header>User</header>
                                <div>
                                    <p>User Setttings</p>
                                </div>
                            </route-page>
                            <route-page path="app">
                                <header>App</header>
                                <div>
                                    <p>App Setttings</p>
                                </div>
                            </route-page>
                        </path-router>
                        <footer>
                            <form method="dialog">
                                <button method="dialog">Close</button>
                            </form>
                        </footer>
                    </dialog>
                </path-router>
            </div>
        </article> -->
      <article class="basic">
        <header>Basic Example</header>
        <div class="description">
          <p>The
            <code>&lt;path-router&gt;</code>
            element has no value set for the
            <code>path</code>
            attribute. This prevents the path-router from starting with a route open.</p>
          <p>To open a route, select an option from the menu below:</p>
        </div>
        <div class="example">
          <menu>
            <a data-route="a">Route A</a>
            <a data-route="b">Route B</a>
            <a data-route="c">Route C</a>
          </menu>
          <path-router>
            <route-page path="a">Route A</route-page>
            <route-page path="b">Route B</route-page>
            <route-page path="c">Route C</route-page>
          </path-router>
        </div>
        <script type="module">
          const basicRouter = document.querySelector('article.basic path-router');
            document.addEventListener('DOMContentLoaded', () =>
            {
                const linksParent = document.querySelector('article.basic menu');
                basicRouter.addRouteLinkClickHandlers(linksParent);
            });
        </script>
      </article>
      <article class="default-route">
        <header>Default Route</header>
        <div class="description">
          <p>
            As long as the
            <code>&lt;path-router&gt;</code>
            element's
            <code>path</code>
            attribute is set, the
            <code>&lt;path-router&gt;</code>
            will auto-navigate.
                    If the
            <code>path</code>
            attribute is set to nothing, set to an empty string, or set to a path that does not match any routes, a default route (configurable, but usually the first child route) will be opened.
          </p>
          <p>The following example has the
            <code>&lt;path-router&gt;</code>'s
            <code>path</code>
            attribute set to an empty string. Note that the first route is opened.</p>
        </div>
        <div class="example">
          <menu>
            <a data-route="first">Route First</a>
            <a data-route="second">Route Second</a>
            <a data-route="third">Route Third</a>
          </menu>
          <path-router id="default-route" path="">
            <route-page path="first">Route First</route-page>
            <route-page path="second">Route Second</route-page>
            <route-page path="third">Route Third</route-page>
          </path-router>
        </div>
        <script type="module">
          const defaultRouteRouter = document.querySelector('article.default-route path-router');
            document.addEventListener('DOMContentLoaded', () =>
            {
                const linksParent = document.querySelector('article.default-route menu');
                defaultRouteRouter.addRouteLinkClickHandlers(linksParent);
            });
        </script>
      </article>
      <article class="starting">
        <header>Starting Route</header>
        <div class="description">
          <p>Set the
            <code>&lt;path-router&gt;</code>
            element's
            <code>path</code>
            attribute to automatically navigate to the matching path when the page is opened.</p>
          <p>The following example is set to open the "Route C" when the page is opened.</p>
        </div>
        <div class="example">
          <menu>
            <a data-route="a">Route A</a>
            <a data-route="b">Route B</a>
            <a data-route="c">Route C</a>
          </menu>
          <path-router id="starting-route" path="c">
            <route-page path="a">Route A</route-page>
            <route-page path="b">Route B</route-page>
            <route-page path="c">Route C</route-page>
          </path-router>
        </div>
        <script type="module">
          const startingRouter = document.querySelector('article.starting path-router');
            document.addEventListener('DOMContentLoaded', () =>
            {
                const linksParent = document.querySelector('article.starting menu');
                startingRouter.addRouteLinkClickHandlers(linksParent);
            });
        </script>
      </article>
      <article class="custom-default">
        <header>Custom Default Route</header>
        <div class="description">
          <p>Setting a
            <code>&lt;route-page&gt;</code>'s
            <code>default</code>
            attribute to any value will set that route to be the route opened in the case that a default route would be opened (no path set, path set to an unmatching value, etc...).</p>
          <p>If multiple
            <code>&lt;route-page&gt;</code>
            elements have a
            <code>default</code>
            attribute, the last
            <code>&lt;route-page&gt;</code>
            listed with the attribute will be used.</p>
          <p>The following example has the
            <code>&lt;path-router&gt;</code>'s
            <code>path</code>
            attribute set to an empty string. Note that the second route is opened.</p>
        </div>
        <div class="example">
          <menu>
            <a data-route="first">Route First</a>
            <a data-route="second">Route Second</a>
            <a data-route="third">Route Third</a>
          </menu>
          <path-router id="custom-default-route" path="">
            <route-page path="first">Route First</route-page>
            <route-page path="second" default>Route Second</route-page>
            <route-page path="third">Route Third</route-page>
          </path-router>
        </div>
        <script type="module">
          const customDefaultRouter = document.querySelector('article.custom-default path-router');
            document.addEventListener('DOMContentLoaded', () =>
            {
                const linksParent = document.querySelector('article.custom-default menu');
                customDefaultRouter.addRouteLinkClickHandlers(linksParent);
            });
        </script>
      </article>
      <article class="subrouting">
        <header>Subrouting</header>
        <div class="description">
          <p>Nesting one
            <code>&lt;path-router&gt;</code>
            element inside of another
            <code>&lt;path-router&gt;</code>
            element does
            <strong>not</strong>
            automatically engage subrouting.
            <code>&lt;path-router&gt;</code>
            elements may be used entirely independently of one another, on the same page.</p>
          <p>For custom requirements, the parent
            <code>&lt;path-router&gt;</code>
            element's events can be handled in javascript, and the child
            <code>&lt;path-router&gt;</code>
            element's path can be set before transitions complete.</p>
          <p>If your route design allows for specific composition, the
            <code>&lt;path-router&gt;</code>
            element can handle subrouting with convention, rather than with additional code. This allows subrouting without any custom javascript at all.</p>
          <p>Default subroute handling also includes handling for
            <code>route-link</code>
            and
            <code>route-button</code>
            elements to determine if they represent a link to the currently open route.</p>
        </div>
        <div class="example">
          <menu>
            <a data-route="home">Home</a>
            <a data-route="about/app">About</a>
            <a data-route="about/faq">FAQ</a>
            <a data-route="contact">Contact</a>
          </menu>
          <path-router class="example" path="about/mission">
            <route-page path="home">Home</route-page>
            <route-page class="about" path="about">
              <header>About</header>
              <menu>
                <a data-route="about/app">App</a>
                <a data-route="about/company">Company</a>
                <a data-route="about/mission">Mission</a>
                <a data-route="about/faq">FAQ</a>
              </menu>
              <route-page path="app" default>This App</route-page>
              <route-page path="company">Company</route-page>
              <route-page path="mission">Mission</route-page>
              <route-page path="faq">FAQ</route-page>
            </route-page>
            <route-page path="contact">Contact</route-page>
          </path-router>
        </div>
        <script>
          const subroutingExample = document.querySelector('article.subrouting');
            const subroutingRouters = {
                example: subroutingExample.querySelector('path-router.example'),
                about: subroutingExample.querySelector('path-router.about'),
            };
            const aboutPage = document.querySelector('route-page.about');

            document.addEventListener('DOMContentLoaded', init);

            async function init(example)
            {
                // each router can have active links added separately
                const exampleLinksParent = subroutingExample.querySelector('.example > menu');
                subroutingRouters.example.addRouteLinkClickHandlers(exampleLinksParent);

                const aboutLinksParent = subroutingExample.querySelector('route-page.about > menu');
                subroutingRouters.example.addRouteLinkClickHandlers(aboutLinksParent);

                // before the about page is opened, collect the
                // properties used to open it with. If there is
                // a subroute provided, it will be represented
                // in the route properties
                // aboutPage.addEventListener('beforeopen', async () =>
                // {
                //     // get the properties that route path is 
                //     // expecting which are provided in the router's path attribute
                //     const properties = aboutPage.getProperties();

                //     // use the subroute as the value for the subrouter's path
                //     await subroutingRouters.about.navigate(properties.subroute);
                // });
            }
        </script>
      </article>
      <article class="route-properties">
        <header>Route Properties</header>
        <div class="description">
          <p>Route properties are defined with a
            <code>:</code>
            prefix. For example,
            <code>:id</code>
            defines a route property named "id".</p>
          <p>Route properties allow multiple different paths to open the same route. When a
            <code>&lt;route-page&gt;</code>
            element has a route property defined in it's
            <code>path</code>
            attribute, that route can be accessed by any path that can match the value after substituting variables for the supplied values.</p>
        </div>
        <div class="example">
          <menu>
            <a data-route="home">Home</a>
            <a data-route="user/">User</a>
            <a data-route="contact">Contact</a>
            <button type="button" class="get-properties example">Parent Router:
              <code>getProperties()</code></button>
          </menu>
          <path-router class="example" path="">
            <route-page class="home-page" path="home">
              <header>Home</header>
              <button data-route="user/1">User 1</button>
              <button data-route="user/2">User 2</button>
              <button data-route="user/3">User 3</button>
              <button data-route="user/4">User 4</button>
              <button data-route="user/4/contact/2">User 4 - Contact 2</button>
            </route-page>
            <route-page class="user-page" path="user">
              <header>User</header>
              <menu>
                <a data-route="user/1">User 1</a>
                <a data-route="user/2">User 2</a>
                <a data-route="user/3">User 3</a>
                <a data-route="user/4">User 4</a>
                <button type="button" class="get-properties user">User Router:
                  <code>getProperties()</code></button>
              </menu>
              <div class="user">
                <route-page path="1"><header>User 1</header></route-page>
                <route-page path="2"><header>User 2</header></route-page>
                <route-page path="3"><header>User 3</header></route-page>
                <route-page class="contacts-page" path="4">
                  <header>User 4</header>
                  <menu>
                    <a data-route="user/4/contact/1">Contact 1</a>
                    <a data-route="user/4/contact/2">Contact 2</a>
                    <a data-route="user/4/contact/3">Contact 3</a>
                    <a data-route="user/4/contact/4">Contact 4</a>
                    <button type="button" class="get-properties contacts">User Contact Router:
                      <code>getProperties()</code></button>
                  </menu>
                  <div class="contacts">
                    <route-page>User Contacts</route-page>
                    <route-page class="contact-page" path="contact/:contactId">
                      User Contact
                      <span id="user-contact-id"></span>
                    </route-page>
                  </div>
                </route-page>
              </div>
            </route-page>
            <route-page path="contact">Contact</route-page>
          </path-router>
          <div class="log">
            <header>
              <span class="title">Properties Log</span>
            </header>
            <ul id="properties-log"></ul>
          </div>
        </div>
        <script>
          const routePropertiesExample = document.querySelector('article.route-properties');
                const routePropertiesRouters = {
                    example: routePropertiesExample.querySelector('path-router.example'),
                    user: routePropertiesExample.querySelector('path-router.user'),
                    userContacts: routePropertiesExample.querySelector('path-router.contacts'),
                };
                const userPage = document.querySelector('route-page.user-page');
                const contactsPage = document.querySelector('route-page.contacts-page');
                const contactPage = document.querySelector('route-page.contact-page');

                const userContactId = document.querySelector('#user-contact-id');

                const propertiesLog = document.querySelector('#properties-log');

                document.addEventListener('DOMContentLoaded', init);

                async function init(example)
                {
                    // each router can have active links added separately
                    const exampleLinksParent = routePropertiesExample.querySelector('.example > menu');
                    routePropertiesRouters.example.addRouteLinkClickHandlers(exampleLinksParent);
                    // if necessary, multiple batches of links can affect the same router
                    const exampleButtonLinksParent = routePropertiesExample.querySelector('.home-page');
                    routePropertiesRouters.example.addRouteLinkClickHandlers(exampleButtonLinksParent);

                    const userLInksParent = routePropertiesExample.querySelector('.user-page > menu');
                    routePropertiesRouters.example.addRouteLinkClickHandlers(userLInksParent);

                    const contactLinksParent = contactsPage.querySelector(':scope > menu');
                    routePropertiesRouters.example.addRouteLinkClickHandlers(contactLinksParent);

                    // the contact page uses a single route that sets
                    // data based on the contact id path property;
                    // instead of just handling when the page opens, 
                    // it also has a handler for the "refresh" event
                    // to account for setting a new contact id, when
                    // already on the contact page
                    const contactPage_onUpdate = async () =>
                    {
                        const properties = contactPage.getProperties();
                        if(properties.contactId != null)
                        {
                            userContactId.textContent = properties.contactId;
                        }
                    };
                    contactPage.addEventListener('beforeopen', contactPage_onUpdate);
                    contactPage.addEventListener('refresh', contactPage_onUpdate);

                    const invokeGetPropertiesButtons = [...document.querySelectorAll('article.route-properties button.get-properties')];
                    for(let i = 0; i < invokeGetPropertiesButtons.length; i++)
                    {
                        const invokeGetPropertiesButton = invokeGetPropertiesButtons[i];
                        invokeGetPropertiesButton.addEventListener('click', () =>
                        {
                            if(invokeGetPropertiesButton.classList.contains('example'))
                            {
                                const routePropertiesProperties = routePropertiesRouters.example.getRouteProperties();
                                logResult(routePropertiesProperties);
                            }
                            else if(invokeGetPropertiesButton.classList.contains('user'))
                            {
                                const routePropertiesUserProperties = userPage.getProperties();
                                logResult(routePropertiesUserProperties);
                            }
                            else if(invokeGetPropertiesButton.classList.contains('contacts'))
                            {
                                const routePropertiesContactsProperties = contactPage.getProperties();
                                logResult(routePropertiesContactsProperties);
                            }
                        });
                    }
                }

                function logResult(result)
                {
                    const entry = document.createElement('li');
                    entry.classList.add('entry');
                    const code = document.createElement('code');
                    const pre = document.createElement('pre');
                    pre.textContent = JSON.stringify(result, null, 2);
                    code.append(pre);
                    entry.append(code);
                    propertiesLog.append(entry);
                }
        </script>
      </article>
      <article class="dialog">
        <header>Dialog Routes</header>
        <div class="description">
          <p>Dialog routes are managed as a secondary routing layer. This allows dialogs to be managed by common single-path routing methods, often used in web apps, without unwanted side effects like closing the current route.</p>
          <p>Dialog routes can be used like any other route, including awaiting transitions, and handling events.</p>
        </div>
        <div class="example">
          <menu>
            <button data-route="#config">App Config</button>
            <a data-route="home">Home</a>
            <a data-route="about">About</a>
          </menu>
          <path-router id="dialog-route" path="about">
            <route-page path="home">Home</route-page>
            <route-page path="about">About</route-page>
            <dialog is="route-dialog" path="config">
              <header>App Configuration</header>
              <div>
                <p>This dialog will open without closing the "home" or "about" pages.</p>
                <p>The dialog is opened by matching what is after the "hash" character (<code>#</code>), while the primary route is set (or unchanged) by matching what is before the hash character.</p>
              </div>
              <footer>
                <form method="dialog"><button>Close</button></form>
              </footer>
            </dialog>
          </path-router>
        </div>
        <script type="module">
          const dialogRouter = document.querySelector('article.dialog path-router');
                document.addEventListener('DOMContentLoaded', () =>
                {
                    const linksParent = document.querySelector('article.dialog menu');
                    dialogRouter.addRouteLinkClickHandlers(linksParent);
                });
        </script>
      </article>
      <article class="transitions">
        <header>Transitions</header>
        <div class="description">
          <p>The
            <code>&lt;route-page&gt;</code>
            and
            <code>route-dialog</code>
            elements dispatch custom events when navigation is occurring. There are four total events, but the events may be assigned in two ways: "normally" or "blocking". These are handled by two separate sets of event handlers, so you can specify the preference in implementation.</p>
          <p>Using the standard
            <code>addEventListener</code>
            function will add an event that does NOT block the page from transitioning. The handler will run simultaneously with the css transitions.</p>
          <p>If you need to prevent a route from opening until after your handler has finished its work, you can use the custom
            <code>addBlockingEventListener</code>, in the same way, using the same event name.</p>
          <p>Since the handlers will be awaited, you can use asynchronous code within the handler. This allows dynamic content to be set during the transitions.</p>
          <p><code>before</code>
            events will fire before any css transitions or animations are applied and
            <code>after</code>
            events will fire after all css transitions and animations have finished.</p>
        </div>
        <div class="example">
          <menu>
            <a data-route="events">Event Types</a>
            <a data-route="before-page-open">Blocking - Before Open</a>
            <a data-route="before-page-close">Blocking - Before Close</a>
            <a data-route="#webcam">Webcam Dialog</a>
          </menu>
          <path-router
            id="transitions"
            path=""
          >
            <route-page path="events">
              <h3>Events</h3>
              <ul>
                <li><code>beforeopen</code></li>
                <li><code>afteropen</code></li>
                <li><code>beforeclose</code></li>
                <li><code>afterclose</code></li>
              </ul>
            </route-page>
            <route-page path="before-page-open">
              <h3>Before Page Open</h3>
            </route-page>
            <route-page path="before-page-close">
              <h3>Before Page Close</h3>
            </route-page>
            <dialog is="route-dialog" path="webcam">
              <h2>Webcam</h2>
              <video></video>
              <form method="dialog"><button method="dialog">Close</button></form>
            </dialog>
          </path-router>
          <div class="log">
            <header>Event Log</header>
            <ul id="transitions-event-log"></ul>
          </div>
        </div>
        <script>
          const transitions = document.getElementById('transitions');
                const eventTypes = transitions.querySelector('route-page[path="events"]');
                const beforePageOpen = transitions.querySelector('route-page[path="before-page-open"]');
                const beforePageClose = transitions.querySelector('route-page[path="before-page-close"]');
                const webcam = transitions.querySelector('dialog[path="webcam"]');
                const eventLog = document.querySelector('#transitions-event-log');

                document.addEventListener('DOMContentLoaded', init);

                const asyncEventHandlers_beforeOpen = async (event) =>
                {
                    logEvent('page prevented from opening while handler is awaiting');
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    logEvent('handler has finished awaiting, page resumes opening');
                }
                const asyncEventHandlers_beforeClose = async (event) =>
                {
                    logEvent('page prevented from closing while handler is awaiting');
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    logEvent('handler has finished awaiting, page resumes closing');
                }

                async function init(example)
                {
                    const linksParent = document.querySelector('article.transitions menu');
                    transitions.addRouteLinkClickHandlers(linksParent);

                    eventTypes.addEventListener('afteropen', () =>
                    {
                        logEvent('this event will fire after the css transition has finished.');
                    });

                    beforePageOpen.addBlockingEventListener('beforeopen', asyncEventHandlers_beforeOpen);
                    beforePageClose.addBlockingEventListener('beforeclose', asyncEventHandlers_beforeClose);

                    webcam.addBlockingEventListener('beforeopen', async () =>
                    {
                        logEvent('dialog prevented from opening while handler is awaiting');
                        await new Promise(resolve => setTimeout(resolve, 1000));
                        logEvent('handler has finished awaiting, dialog resumes opening');
                    });
                    webcam.addEventListener('afteropen', () =>
                    {
                        logEvent(`this event will fire after the dialog's css transition has finished.`);
                    });
                }

                function logEvent(message)
                {
                    console.log(message);
                    const entry = document.createElement('li');
                    entry.textContent = message;
                    entry.classList.add('entry');
                    eventLog.append(entry);
                }
        </script>
      </article>
      <article class="history">
        <header>Browser History Management</header>
        <div class="description">
          <p>This browser mockup demonstrates how the
            <code>&lt;path-router&gt;</code>
            element's navigation events can be handled. This demo page does not actually manipulate your browser's history.</p>
          <p>Instead, this demo collects the full, current path from the
            <code>&lt;path-router&gt;</code>
            element's
            <code>composed-path</code>
            attribute, and then uses the element's
            <code>compareLocation</code>
            function to determine whether or not the path has changed, and if the change was a simple navigation, or a "replacement" navigation (for dialog-to-dialog transitions).</p>
          <p>When navigating through the routes in the browser mockup demo, you can use the "Forward" and "Back" buttons to simulate browser history navigation.</p>
          <p>To see a demonstration that actually manipulates your browser's history, see
            <a href="./active-browser-navigation.html">the Active Browser Navigation demo</a>.</p>
        </div>
        <div class="example">
          <browser-mockup url="https://www.path-router.com" tabs="1" collapsed-tabs="2" class="windows">
            <div class="layout" data-theme="heading-nav">
              <menu id="page-menu">
                <a data-theme="heading-nav" data-route="home">Routing</a>
                <a data-theme="heading-nav" data-route="user/">User</a>
                <a data-theme="heading-nav" data-route="help">Help</a>
                <a data-theme="heading-nav" data-route="help/faq">FAQ</a>
                <a data-theme="heading-nav" data-route="help/contact">Contact</a>
              </menu>
              <path-router
                id="page-router"
                path=""
                data-theme="heading-nav"
              >
                <route-page path="home" class="home-page">
                  <h3>Routing</h3>
                  <p>Routes can define simple routes, nested routes, and dialog routes, which provide a secondary routing path for displaying dialogs over existing route content.</p>
                  <button type="button" data-theme="heading-nav" data-route="#about">Open Dialog Route</button>
                  <button type="button" data-theme="heading-nav" data-route="#about/website">Open Dialog Subroute</button>
                  <p>Routes can include variables by using a colon character before the variable name (ex: 'routeA/:id' defines the route variable of "id" for the "routeA" route).</p>
                  <button type="button" data-theme="heading-nav" data-route="user/1">Open User 1</button>
                  <button type="button" data-theme="heading-nav" data-route="user/2">Open User 2</button>
                  <button type="button" data-theme="heading-nav" data-route="user/3">Open User 3</button>
                  <p>Nested routes can be linked to from top-level path-router elements by using variables.</p>
                  <button type="button" data-theme="heading-nav" data-route="user/1/contact/alice">Open Alice Contact</button>
                  <button type="button" data-theme="heading-nav" data-route="user/1/contact/bob">Open Bob Contact</button>
                </route-page>
                <route-page path="user/:id" class="user-page">
                  <h3>User</h3>
                  <p>Routes can be nested by adding a path-router element as a child of a route-page element.</p>
                  <nav>
                    <a data-theme="tabs" data-route="user/:id/profile">Profile</a>
                    <a data-theme="tabs" data-route="user/:id/contact/main">Contacts</a>
                  </nav>
                  <div id="user-router" data-theme="tabs">
                    <route-page path="profile">
                      <h4>User Profile</h4>
                      <p>By giving the route a variable, like ":subpage", the remanining route can be passed down to the nested path-router element.</p>
                    </route-page>
                    <route-page path="contact" class="contact-page">
                      <div id="user-contact-router">
                        <route-page path="main">
                          <h4>User Contacts</h4>
                          <p>Nested routes can also have path-router elements.</p>
                          <p>By using variables and route-link elements, a nested path can be navigated to without any javascript needed for the implementer.</p>
                          <nav>
                            <style>
                              .link { padding: 0 .2em; cursor: pointer; }
                              .link:hover { text-decoration: underline ;}
                            </style>
                            <a class="link" data-route="alice">Alice</a>
                            <a class="link" data-route="bob">Bob</a>
                          </nav>
                        </route-page>
                        <route-page path=":contactId" class="contact-data-page">
                          <h4><span class="contact-data">[Contact]</span></h4>
                          <p><span class="contact-data">[Contact]</span>'s Contact Info</p>
                          <a class="link" data-route="#address">See Address</a>
                          <a class="link" data-route="user/:id/contact">Back</a>
                        </route-page>
                      </div>
                    </route-page>
                  </div>
                </route-page>
                <route-page path="help" class="help-page">
                  <h2>Help</h2>
                  <nav>
                    <a data-theme="sidebar" data-route="help/faq">FAQ</a>
                    <a data-theme="sidebar" data-route="help/contact">Contact</a>
                  </nav>
                  <path-router id="help-router" data-theme="sidebar">
                    <route-page path="faq">
                      <h3>Frequently Asked Questions</h3>
                      <p>Answer Content</p>
                    </route-page>
                    <route-page path="contact">
                      <h3>Contact Us</h3>
                      <p>Contact Content</p>
                    </route-page>
                  </path-router>
                </route-page>
                <dialog is="route-dialog" class="about-dialog" path="about">
                  <h2>About</h2>
                  <p>About Content</p>
                  <nav>
                    <a data-theme="tabs" data-route="#about/company">Company</a>
                    <a data-theme="tabs" data-route="#about/website">Website</a>
                  </nav>
                  <div id="about-router">
                    <route-page path="company">
                      <h3>About Company</h3>
                      <p>About Company Content</p>
                    </route-page>
                    <route-page path="website">
                      <h3>About Website</h3>
                      <p>About Website Content</p>
                      <button type="button" is="route-button" for="page-router" data-theme="heading-nav" path="#disclaimer">See Disclaimer</button>
                    </route-page>
                  </div>
                  <form method="dialog"><button method="dialog">Close</button></form>
                </dialog>
                <dialog is="route-dialog" path="disclaimer">
                  <h2>Disclaimer</h2>
                  <p>Disclaimer content</p>
                  <button type="button" is="route-button" for="page-router" data-theme="heading-nav" path="#about">Back to About</button>
                  <form method="dialog"><button method="dialog">Close</button></form>
                </dialog>
                <dialog is="route-dialog" path="address">
                  <h2>Contact Address</h2>
                  <p>Contact Address Content</p>
                  <form method="dialog"><button method="dialog">Close</button></form>
                </dialog>
              </path-router>
            </div>
          </browser-mockup>
        </div>
        <script type="module" src="./browser-mockup.min.js"></script><!-- Browser Mockup library from here: https://github.com/catapart/magnitce-browser-mockup -->
        <script type="module">
          import { PathRouterElement } from '../vanilla/path-router.js';

                const browserMockup = document.body.querySelector('browser-mockup');

                document.addEventListener('DOMContentLoaded', () =>
                {
                    const pageRouter = document.querySelector('#page-router');
                    const pageMenu = document.querySelector('#page-menu');
                    const homePage = pageRouter.querySelector('.home-page');

                    const userPage = pageRouter.querySelector('.user-page');
                    const userPageMenu = userPage.querySelector('nav');
                    const userRouter = document.querySelector('#user-router');
                    
                    const userContactPage = userRouter.querySelector('.contact-page');
                    const userContactPageMenu = userContactPage.querySelector('nav');
                    const userContactRouter = document.querySelector('#user-contact-router');
                    
                    const userContactDataPage = userContactRouter.querySelector('.contact-data-page');

                    const helpPage = pageRouter.querySelector('.help-page');
                    const helpPageMenu = helpPage.querySelector('nav');
                    const helpRouter = document.querySelector('#help-router');
                    
                    const aboutDialog = pageRouter.querySelector('.about-dialog');
                    const aboutDialogMenu = aboutDialog.querySelector('nav');
                    const aboutRouter = document.querySelector('#about-router');

                    pageRouter.addRouteLinkClickHandlers(pageMenu);
                    pageRouter.addRouteLinkClickHandlers(homePage);

                    pageRouter.addRouteLinkClickHandlers(userPageMenu);
                    
                    pageRouter.addRouteLinkClickHandlers(userContactPageMenu);
                    pageRouter.addRouteLinkClickHandlers(userContactRouter);

                    pageRouter.addRouteLinkClickHandlers(helpPageMenu);

                    pageRouter.addRouteLinkClickHandlers(aboutDialogMenu);
                    
                    // todo: 
                    // add subrouting
                    // - contact router
                    //  - contact dialog name issue
                    // - dialog router
                    // - help router
                    // add history navigation
                    // revise demo copy
                    // update readme copy



                    
                    // before the user page is opened, collect the
                    // properties used to open it with. If there's
                    // a user id, navigate the target router to
                    // that user
                    // userPage.addEventListener('beforeopen', async () =>
                    // {
                    //     // get the properties that route path is 
                    //     // expecting which are provided in the router's path attribute
                    //     const properties = userPage.getProperties();
                    //     if(properties.id != null)
                    //     {
                    //         await userRouter.navigate(properties.subroute);

                    //         // get a set of key/value pairs from the router's path string;
                    //         // these have no encoded relationship to properties, but they
                    //         // usually share a semantic relationship.
                    //         // in this example, a value provided in the path after "contact"
                    //         // to the user router can be used as the ":contactId" property
                    //         // for the contacts router.
                    //         const pathValuePairs = userRouter.getPathValuePairs();
                    //         if(pathValuePairs.contact != null)
                    //         {
                    //             userContactRouter.navigate('contact/' + pathValuePairs.contact);
                    //         }
                    //     }
                    // });

                    // the contact page uses a single route that sets
                    // data based on the contact id path property;
                    // instead of just handling when the page opens, 
                    // it also has a handler for the "refresh" event
                    // to account for setting a new contact id, when
                    // already on the contact page
                    const contactPage_onUpdate = async () =>
                    {
                        const contactProperties = userContactDataPage.getProperties();
                        const dataElements = userContactRouter.querySelectorAll('.contact-data');
                        if(contactProperties.contactId != null 
                        && contactProperties.contactId.trim() != "")
                        {
                            dataElements.forEach(element => 
                            {
                                const titleCased = contactProperties.contactId.substring(0, 1).toUpperCase() + contactProperties.contactId.substring(1);
                                element.textContent = titleCased;
                            });
                        }
                    };
                    userContactPage.addEventListener('beforeopen', contactPage_onUpdate);
                    userContactPage.addEventListener('refresh', contactPage_onUpdate);


                    // fix dialog subroute
                    // let historyIsUpdating = false;

                    // pageRouter.addEventListener('pathcompose', pageRouter_onPathCompose);
                    // function pageRouter_onPathCompose(event)
                    // {
                    //     // prevent changing the url using events from subrouters
                    //     if(event.target != pageRouter) { return; }

                    //     // if we're moving back or forward,
                    //     // we don't want to record that in history
                    //     // and the browser will update the url
                    //     if(historyIsUpdating == true) { return; } 
                        
                    //     const currentLocation = new URL(browserMockup.getAttribute('url')); // equivalent to `window.location`

                    //     let updatedPath = pageRouter.getAttribute('composed-path');
                    //     const origin = 'https://www.path-router.com' // reference window's origin with `window.location.origin`;
                    //     const updatedLocation = new URL(origin + updatedPath);

                    //     const { hasChanged, isReplacementChange } = pageRouter.compareLocations(currentLocation, updatedLocation);
                    //     if(hasChanged)
                    //     {
                    //         if(isReplacementChange)
                    //         {
                    //             browserMockup.history.replace(updatedLocation.href);
                    //             // equivalent to `window.history.replaceState(null, '', updatedLocation.href);`
                    //         }
                    //         else
                    //         {
                    //             browserMockup.history.add(updatedLocation.href);
                    //             // equivalent to `window.history.pushState(null, '', updatedLocation.href);`
                    //         }
                    //     }
                    // }

                    // const routeLinks = [...document.querySelectorAll('[is="route-link"],[is="route-button"]')];
                    // for(let i = 0; i < routeLinks.length; i++)
                    // {
                    //     routeLinks[i].onPreparePath = prepareRouteLink;
                    // }
                    // function prepareRouteLink(path)
                    // {
                    //     const url = browserMockup.getAttribute('url') ?? ""; // equivalent to `window.location.href`
                    //     const urlParameters = PathRouterElement.getUrlParameters(url);

                    //     if(path.indexOf(':id') > -1)
                    //     {
                    //         const idValue = urlParameters.user;
                    //         const id = parseInt(idValue);
                    //         const userId = isNaN(id) ? -1 : id;
                    //         if(userId > -1)
                    //         {
                    //             path = path.replace(":id", userId);
                    //         }
                    //     }
                    //     if(path.indexOf(':contactId') > -1)
                    //     {
                    //         const idValue = urlParameters.contact;
                    //         const contactId = parseInt(idValue);
                    //         path = path.replace(":contactId", urlParameters.contact);
                    //     }

                    //     return path;
                    // }                
                });
                

                // equivalent to `window.addEventListener('popstate', [...])`;
                browserMockup.addEventListener('popstate', async (event) =>
                {
                    historyIsUpdating = true;
                    const location = new URL(browserMockup.getAttribute('url')) // reference the window's location with `window.location`;
                    const path = location.pathname; // equivalent to `window.location.pathname`;
                    const hash = location.hash; // equivalent to `window.location.hash`;
                    const route = path + hash;
                    await pageRouter.navigate(route);
                    historyIsUpdating = false;
                });
        </script>
      </article>
      <article class="themes">
        <header>Themes</header>
        <div class="description">
          <p>For convenience, three basic themes have been included in the library to set some very simplistic structures and colors on the library's elements.</p>
          <p>None of the elements require these themes to function or to be displayed in a useable way in the browser.</p>
          <p>These are mainly provided so that a designer can have a reference for how elements are targeted by selectors.</p>
          <p>To apply a theme, use the
            <code>data-theme</code>
            attribute with one of the following values:</p>
          <ul>
            <li><code>tabs</code></li>
            <li><code>sidebar</code></li>
            <li><code>heading-nav</code></li>
          </ul>
          <p>The
            <code>data-theme</code>
            attribute can be used on
            <code>&lt;path-router&gt;</code>
            elements, as well as on
            <code>route-link</code>
            and
            <code>route-dialog</code>
            elements.</p>
        </div>
        <header><code>tabs</code></header>
        <div class="example tabs">
          <menu>
            <a data-theme="tabs" data-route="a">Route A</a>
            <a data-theme="tabs" data-route="b">Route B</a>
            <a data-theme="tabs" data-route="c">Route C</a>
          </menu>
          <path-router id="theme-tabs" data-theme="tabs" path="">
            <route-page path="a">Route A</route-page>
            <route-page path="b">Route B</route-page>
            <route-page path="c">Route C</route-page>
          </path-router>
          <script type="module">
            const tabsRouter = document.querySelector('.example.tabs path-router');
                    document.addEventListener('DOMContentLoaded', () =>
                    {
                        const linksParent = document.querySelector('.example.tabs menu');
                        tabsRouter.addRouteLinkClickHandlers(linksParent);
                    });
          </script>
        </div>
        <header><code>sidebar</code><small><em>(note additional
              <code>display: flex</code>
              property on this example container)</em></small></header>
        <div class="example sidebar" style="display:flex;">
          <menu>
            <a data-theme="sidebar" data-route="a">Route A</a>
            <a data-theme="sidebar" data-route="b">Route B</a>
            <a data-theme="sidebar" data-route="c">Route C</a>
          </menu>
          <path-router id="theme-sidebar" data-theme="sidebar" path="">
            <route-page path="a">Route A</route-page>
            <route-page path="b">Route B</route-page>
            <route-page path="c">Route C</route-page>
          </path-router>
          <script type="module">
            const sidebarRouter = document.querySelector('.example.sidebar path-router');
                    document.addEventListener('DOMContentLoaded', () =>
                    {
                        const linksParent = document.querySelector('.example.sidebar menu');
                        sidebarRouter.addRouteLinkClickHandlers(linksParent);
                    });
          </script>
        </div>
        <header><code>heading-nav</code></header>
        <div class="example heading-nav">
          <menu>
            <a data-theme="heading-nav" data-route="a">Route A</a>
            <a data-theme="heading-nav" data-route="b">Route B</a>
            <a data-theme="heading-nav" data-route="c">Route C</a>
          </menu>
          <path-router id="theme-heading-nav" data-theme="heading-nav" path="">
            <route-page path="a">Route A</route-page>
            <route-page path="b">Route B</route-page>
            <route-page path="c">Route C</route-page>
          </path-router>
          <script type="module">
            const headingNavRouter = document.querySelector('.example.heading-nav path-router');
                    document.addEventListener('DOMContentLoaded', () =>
                    {
                        const linksParent = document.querySelector('.example.heading-nav menu');
                        headingNavRouter.addRouteLinkClickHandlers(linksParent);
                    });
          </script>
        </div>
      </article>
    </main>
    <script type="module" src="../vanilla/path-router.js"></script>
  </body>
</html>